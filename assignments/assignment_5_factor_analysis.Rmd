---
title: "Assignment 6 solutions"
author: "Anna Noemi Illes"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(psych)         
library(GPArotation)
library(knitr)
library(kableExtra)
library(corrplot)
library(viridis)
library(viridisLite)
library(qgraph)

```

# Introduction

In this lab assignment you will need to explore the factor structure of the Animal Rights Scale, a scale containing 28 items to measure attitudes towards animal experimentation and animal rights. Imagine that you are a researcher who is interested in the underlying factors that govern attitudes towards animal rights and the use of animals for different purposes. You have gathered data using the Animal Rights Scale (ARS) from 154 individuals in an online survey. Your goal is to explore the underlying factors.

# Dataset

You can load the dataset from the 'data/' folder.

The dataset includes the responses of 154 individuals on the following variables:

__ar1-ar28__ contain the data from the 28 items of the ARS. Participants had to rate their agreement with each statement separately on a 1-5 Likert scale with the following anchors: 1 - strongly disagree, 2 – disagree, 3 - no opinion, 4 – agree, 5 - strongly agree.

The questions in the ARS were the following:

  * __ar 1.__ Humans have no right to displace wild animals by converting wilderness areas into farmlands, cities, and other things designed for people.
  * __ar 2.__ Animal research cannot be justified and should be stopped.
  * __ar 3.__ It is morally wrong to drink milk and eat eggs.
  * __ar 4.__ A human has no right to use a horse as a means of transportation (riding) or entertainment (racing).
  * __ar 5.__ It is wrong to wear leather jackets and pants.
  * __ar 6.__ Most medical research done on animals is unnecessary and invalid.
  * __ar 7.__ I have seriously considered becoming a vegetarian in an effort to save animal lives.
  * __ar 8.__ Pet owners are responsible for preventing their pets from killing other animals, such as cats killing mice or snakes eating live mice.
  * __ar 9.__ We need more regulations governing the use of animals in research.
  * __ar 10.__ It is morally wrong to eat beef and other "red" meat.
  * __ar 11.__ Insect pests (mosquitoes, cockroaches, flies, etc.) should be safely removed from the house rather than killed.
  * __ar 12.__ Animals should be granted the same rights as humans.
  * __ar 13.__ It is wrong to wear leather belts and shoes.
  * __ar 14.__ I would rather see humans die or suffer from disease than to see animals used in research.
  * __ar 15.__ Having extended basic rights to minorities and women, it is now time to extend them also to animals.
  * __ar 16.__ God put animals on Earth for man to use.
  * __ar 17.__ There are plenty of viable alternatives to the use of animals in biomedical and behavioral research.
  * __ar 18.__ Research on animals has little or no bearing on problems confronting people.
  * __ar 19.__ New surgical procedures and experimental drugs should be tested on animals before they are used on people.
  * __ar 20.__ I am very concerned about pain and suffering in animals.
  * __ar 21.__ Since many important questions cannot be answered by doing experiments on people, we are left with no alternatives but to do animal research.
  * __ar 22.__ It is a violation of an animal's rights to be held captive as a pet by a human.
  * __ar 23.__ It is wrong to wear animal fur (such as mink coats).
  * __ar 24.__ It is appropriate for humans to kill animals that destroy human property, for example, rats, mice, and pigeons.
  * __ar 25.__ Most cosmetics research done on animals is unnecessary and invalid.
  * __ar 26.__ It is morally wrong to eat chicken and fish.
  * __ar 27.__ Most psychological research done on animals is unnecessary and invalid.
  * __ar 28.__ Hunters play an important role in regulating the size of deer populations.

You can get more information about the ARS here: http://core.ecu.edu/psyc/wuenschk/Animals/Anim-Rights-Q.htm

And also here: 

Wuensch, K. L., Jenkins, K. W., & Poteat, G. M. (2002). Misanthropy, idealism, and attitudes towards animals. _Anthrozoös, 15_, 139-149

Sharp, H. W., Wuensch, K. L., Eppler, M. A., & Harju, B. L. (2006, April). Narcissism, empathy, and attitudes towards animals. In _Spring Conference of the North Carolina Psychological Association and North Carolina Psychological Foundation, Charlotte, NC._

A few other questions were also included in the questionnaire:

__sex:__ The self reported sex of the participant. This is a categorical variable coded as 1 – female, 2 – male.

__party:__ Self reported party affiliation of the person (in the USA). This is a categorical variable coded as 1 - democrat, 2 - republican, 3 - other, 4 – none.

__liberal:__ This variable contains data from a question: please rate how conservative or liberal are you. On a scale of 1-5 where 1 means very conservative and 5 means very liberal. 

# Task

Your task is to do an exploratory factor analysis using the items in the ARS to identify the latent factors underlying the responses. First of all, start by exploring the descriptive statistics and correlations in the dataset to get more familiar with it and to identify any unusual cases or coding errors. Make sure to check the assumptions of factorability and multivariate normality and address them as necessary. You have a free hand in choosing the extraction and rotation methods. You can also exclude items if you see this necessary, but __do not exclude more than 8 items__ in this assignment. (If you still find the average communality below expectations, just report this as a limitation in your report, but continue the task). Keep notes of the steps and different setting/methods you tried during the exploratory factor analysis. 

_(The factor structure of this scale has been previously analyzed by others. If you want, you can use these previous research reports to guide your exploration, or you can ignore them. In any case, do not base your decisions solely on these research reports. Do your own work and base your decisions on your own findings on this dataset.)_

When you have arrived at the factor structure you consider final, give names to the factors you derived from the data. Save the factor scores and build a linear regression model to predict how conservative or liberal participants are (using the “liberal” variable as a dependent variable) with the factors you identified as the predictors.

__To simplify the task you can regard all likert scale variables (ar1-28 and liberal) as if they were continuous variables!__ So you do not have to use polychoric correlation for factor analysis and you do not have to perform ordinal regression.

# What to report

Report if you have found any unusual things (outliers or coding errors) in the dataset and how you dealt with them. Report the results of the assumption checks for factorability and multivariate normality. If any of the assumptions were found to be violated, report what was done to handle that. 

Report the number of factors you chose to keep in your final factor structure and give a rationale why. Include the parallel analysis scree plot in your report. Report the post-extraction eignevalues, variance explained, and cumulative variance explained by the final factors in a table format. Report the average post-extraction communality of the items. 

Report which rotation you chose to use (if any) and why. Report the final factor structure including the factor names. Also, report the post-extraction commonalities of each item and the loadings of the items on the final factors in a table format. (These can be reported in the same table). This table should contain the loadings that you used to interpret the factors in your analysis (e.g. the loadings listed in the rotated factor matrix or the pattern matrix). The table should be structured in a way to help the reader easily see which items load high on which factors.

Report if you have excluded any items, and give a rationale for each. 

Report which factor (if any) was the most influential predictor of how liberal a person is in the linear regression model and explain what do you base this assessment on.

# What to discuss

Talk about the limitations of your study and findings. 

# Solution

## Read the data

Read the Animal Rights Scale (ARQ) dataset from the 'data/' folder. Pay attention to the extension.

```{r}
arq <- read_csv("/Users/illesanna/Desktop/DOKUMENTUMOK/ELTE/MESTER/semester1/data_analysis_r/KPTUXW_interim_assignments/KPTUXW_interim_assignments/data/assignment_5_dataset.csv")
```

## EDA

```{r}
summary(arq)
```

## Data manipulation

Recode the sex and party variables as factor type variables with the following levels:
  * sex: 1 - male, 2 - female
  * party: 1 - democrat, 2 - republican, 3 - other, 4 - none

```{r}
arq_new <- arq %>% 
  mutate(
    sex = factor(sex,
                 levels = c(1, 2),
                 labels = c("male", "female")),
    party = factor(party,
                   levels = c(1, 2, 3, 4),
                   labels = c("democrat", "republican", "other", "none"))
  )
```

# Creating a correlation matrix

__Note:__ Remember to only include the variables of the questionnaire that will be part of the factor analysis.

*Create the correlation matrix.*

```{r}
arq_fa <- arq_new %>%
  select(-c(29, 30, 31))

correlation1 <- cor(
  arq_fa,
  use = "pairwise.complete.obs"
)

```

## Visualizing the correlation matrix

*Create a visualization of the results of the correlation matrix.*

A correlation plot was created in order to check for significant correlations among items. A particularly strong positive correlation can be observed between ar5 and ar 13 (0.83), ar12 and ar15 (0.66) indicating a common underlying latent variable.

```{r}
corrplot(correlation1, method = "color",
         type = "upper",          
         tl.col = "black",         
         tl.srt = 45,             
         addCoef.col = "black",   
         number.cex = 0.7,         
         diag = FALSE) 
```

## Test for factorability

*Calculate the KMO score.*

The suitability of the data for factor analysis was assessed using the **Kaiser-Meyer-Olkin (KMO)** measure of sampling adequacy and **Bartlett’s test of sphericity**. The KMO statistic indicated high sampling adequacy *(KMO = 0.88)*. Bartlett’s test was significant *(p < .001)*, suggesting that the correlation matrix was not an identity matrix and that factor analysis was appropriate. 

```{r}
KMO(arq_fa)

cortest.bartlett(
  correlation1,
  n = nrow(arq_fa)
)
```

## Test for multivariate normality

**Mardia’s tests** indicated that the data deviated from multivariate normality. Both **skewness** *(b1p = 235.50, skew(378) = 5887.38, p < .001)* and **kurtosis** *(b2p = 920.52, kurtosis = 12.03, p < .001)* were significant, suggesting non-normality in the multivariate distribution of the 28 variables included in the analysis (n = 150).

```{r}
mardia <- mardia(arq_fa)
mardia
```

Skewness and kurtosis were individually checked across all 28 variables included in the analysis. The following variables were flagged, as these exceed the conventional threshold of -1 ans 1 for both skewness and kurtosis:
- ar3: moderate skewness, high kurtosis
- ar10: moderate skewness, moderate kurtosis
- ar14: moderate skewness, high kurtosis
- ar26: moderate skewness, moderate kurtosis

I opted for excluding these variables from further analysis in order to receive a clear factor structure not affected by extreme deviations from normality. 

```{r}
describe(arq_fa)[, c("skew", "kurtosis")]
```


```{r}
arq_fa_clean <- arq_fa %>%
  select(-c(3, 10, 14, 26))

mardia_clean <- mardia(arq_fa_clean)
mardia_clean
```

As the **Mardia's test** still indicated significant deviation from normality, I further excluded ar22 from the analysis as this variable also demonstrated moderate skewness and kurtosis.

```{r}
arq_fa_final <- arq_fa %>%
  select(-c(3, 10, 14, 22, 26))

mardia_final <- mardia(arq_fa_final)
mardia_final

correlation <- cor(
  arq_fa_final,
  use = "pairwise.complete.obs"
)
```


## Create scree plot

Create a **scree plot** to help the decision on how many factors to include.

To determine the number of factors, both a **scree plot** and a **parallel analysis** were employed. The scree plot suggested retaining **two factors**, all with eigenvalues above 1, in accordance with the Kaiser criterion. The parallel analysis, which compared the observed eigenvalues with those obtained from randomly generated data, suggested that **three** factors should be retained. A total of **two factors** are located above the elbow, the point from which a steep decline can be detected. 

I retained a total of *two factors* as this point also marks the point of inflection (elbow).

```{r}
scree(arq_fa_final)

fa.parallel(arq_fa_final)
```

## Run the factor analysis

*Run the factor analysis with the chosen number of factors.*

I conducted an **exploratory factor analysis (EFA)** using principal axis factoring with an *oblimin/oblique* rotation on 23 variables. An oblique rotation was selected because the underlying latent constructs were expected to be related, allowing for correlations between factors.

Factor scores were calculated using regression scoring. The correlations between the estimated factor scores and the corresponding factors were high (F1 = 0.94, F2 = 0.93, indicating that the scores accurately represent the underlying factors. The proportion of variance in each factor explained by the scores (multiple R square) was also high (F1 = 0.89, F2 = 0.86). The minimum correlations of the possible factor scores with the factors ranged were F1 = 0.77 and F2 = 0.70, further confirming that the factor scores provide a reliable representation of the factor structure.

```{r}
efa <- fa(correlation, nfactors = 2, n.obs = nrow(arq_fa_final), fm = "pa", rotate = "oblimin")
efa
```

*Sort the communality scores in decreasing order.*

After conducting the EFA, the factor loadings and communality scores of all variables were examined, yielding the following factor structure. Negative loadings due to reversed items are marked in *italic* style. 

**F1:** ar7 (0.68), ar5 (0.64), ar13 (0.62), ar4 (0.61), ar15 (0.59), ar12 (0.51), ar23 (0.49), ar20 (0.47), ar1 (0.40), ar25 (0.36), *ar16 (-0.40)*, *ar21 (-0.36)*, *ar19 (-0.42)*, *ar24 (-0.69)*, *ar28 (-0.43)*

**F2:** ar6 (0.73), ar27 (0.63), ar17 (0.66), ar12 (0.26), ar11 (0.35), ar8 (0.34), ar2 (0.59), ar18 (0.53), ar21 (-0.13), ar9 (0.33), *ar19 (-0.16)*

Almost no variables exceeded 0.7, indicating weak to moderate relationship between items and their respective factors. Several items (notably, ar9, ar11 and ar25) showed similar loadings on both factors as well. These items were retained to preserve content validity, but their cross-loadings suggest that they may be related to multiple latent constructs.

The following items showed weak communalites, thus these were removed from further analysis as results suggested these items do not explain a high amount of variance within their respective factors:
- ar16 (h2 = 0.25)

- ar8 (h2 = 0.14)

- ar28 (h2 = 0.14)

```{r}
# factor loadings
loadings <- efa$loadings

# mean communality scores
h2 <- efa$communality

# joining loadings and mean communality scores
loadings_mat <- as.data.frame(as.matrix(unclass(loadings)))
n_factors <- ncol(loadings_mat)
colnames(loadings_mat) <- paste0("F", 1:n_factors)

tab <- cbind(loadings_mat, h2 = round(h2, 2))

#arranging according to commuanility descending order
tab <- tab %>%
  rownames_to_column(var = "Item") %>%
  arrange(desc(h2))

kable(tab, caption = "Rotated Pattern Loadings (Oblimin) and Communalities", digits = 2) %>%
  kable_styling(full_width = FALSE)
```


```{r}
arq_fa_comm <- arq_fa %>%
  select(-c(3, 8, 10, 14, 16, 22, 26, 28))

correlation2 <- cor(
  arq_fa_comm,
  use = "pairwise.complete.obs"
)

efa2 <- fa(
  arq_fa_comm,
  nfactors = 2,
  fm = "pa",
  rotate = "oblimin",
  scores = "regression"
)
efa2

loadings2 <- efa2$loadings
h2_2 <- efa2$communality

# joining loadings and mean communality scores
loadings_mat2 <- as.data.frame(as.matrix(unclass(loadings2)))
n_factors2 <- ncol(loadings_mat2)
colnames(loadings_mat2) <- paste0("F", 1:n_factors2)

tab2 <- cbind(loadings_mat2, h2_2 = round(h2_2, 2))

#arranging according to commuanility descending order
tab2 <- tab2 %>%
  rownames_to_column(var = "Item") %>%
  arrange(desc(h2_2))

kable(tab2, caption = "Rotated Pattern Loadings (Oblimin) and Communalities", digits = 2) %>%
  kable_styling(full_width = FALSE)

```


Following the exclusion process, I conducted another EFA analysis with Principal Axis Factoring oblimin/oblique rotation on the remaining 20 variables as well.

The correlations between the estimated factor scores and the corresponding factors remained unchanged  *(F1 = 0.94, F2 = 0.93)*, indicating that the scores still accurately represent the underlying factors. The proportion of variance in each factor explained by the scores (multiple R square) also remained high *(F1 = 0.89, F2 = 0.87)*. The minimum correlations of the possible factor scores with the factors showed slight improvement, *F1 = 0.78 and F2 = 0.75*, further confirming that the factor scores provide a reliable representation of the factor structure. 

Examination of factor loadings and communality scores yielded the following factor structure (with reversed scores flagged in *italic* style)

**F1:** ar7 (0.67), ar5 (0.81), ar13 (0.77), ar4 (0.63), ar15 (0.50), ar23 (0.53), ar20 (0.38), ar12 (0.45), ar1 (0.38), ar25 (0.32), ar11 (0.30), *ar19 (-0.30)*, *ar24 (-0.54)*

**F2:** ar6 (0.81), ar27 (0.70), ar17 (0.60), ar2 (0.60), ar18 (0.53), ar21 *(-0.28)*, ar9 (0.39)

Based on the content of the items, **Factor1 (F1)** was labeled **Animal Rights**, reflecting moral opposition to the use and exploitation of animals, whereas **Factor2 (F2)** was labeled **Animal Research**, capturing attitudes toward the necessity, regulation, and validity of animal research.

*Visualize the factor structure.*

Two **bar plots** were created to display the factor loadings of the items included in the analysis, presented separately for Factor 1 ("Animal research") and Factor 2 (Animal rights).

```{r}
tab3 <- cbind(loadings_mat2, h2_2 = round(h2_2, 2))

tab3 <- tab3 %>%
  rownames_to_column(var = "Item") %>%
  mutate(
    Factor = case_when(
      abs(F1) >= abs(F2) ~ "Animal rights",
      abs(F2) > abs(F1)  ~ "Animal research"
    )
  ) %>%
  arrange(desc(h2_2))


loadings_plot <- tab3 %>%
  pivot_longer(
    cols = c(F1, F2),
    names_to = "LatentFactor",
    values_to = "Loading"
  ) %>%
  # keep only the primary loading for each item
  filter(
    (Factor == "Animal rights"  & LatentFactor == "F1") |
    (Factor == "Animal research" & LatentFactor == "F2")
  )

ggplot(loadings_plot, aes(Item, abs(Loading), fill = Loading)) +
  facet_wrap(~ Factor, nrow = 1) +
  geom_bar(stat = "identity") +
  coord_flip() +
  scale_fill_gradient2(
    name = "Loading",
    high = "#C8A2C8",
    mid  = "#B0E0E6",
    low  = "#C1E1C1",
    midpoint = 0,
    guide = "none"
  ) + labs(title = "Factor structure",
           x = "Items, arranged according to communality scores (highest to lowest)",
           y = "Loading strength") +
  theme_bw(base_size = 10)
```

## Run linear regression

*Calculate the factor scores.*

```{r}
factor_scores <- as.data.frame(efa2$scores)
colnames(factor_scores) <- c("Animal_rights", "Animal_research")

```


*Bind factor scores to the original dataset.*

```{r}
arq_scored <- arq_new %>% 
    select(-c(3, 8, 10, 14, 16, 22, 26, 28))

arq_fa_regression <- bind_cols(arq_scored, factor_scores)
```

*Run the linear regression.*

A **linear regression** was conducted to examine whether the *Animal rights* (F1) and *Animal research* (F2) factors predicted liberal political attitudes (1 = conservative, 5 = liberal). The model was statistically significant, F(2, 146) = 4.04, p = .020, explaining 5.2% of the variance in liberalism (R² = .05, adjusted R2 = .04). The *Animal rights* factor was a significant positive predictor of liberal attitudes (B = 0.27, SE = 0.10, t = 2.60, p = .010), whereas the *Animal reserarch* factor was not (B = −0.11, SE = 0.11, t = −1.05, p = .29).

```{r}
regression <- lm(
  liberal ~ Animal_rights + Animal_research,
  data = arq_fa_regression
)

summary(model_lm)
```


# Summary

Based on the scree plot and parallel analysis, **two factors** were retained for the exploratory factor analysis. An oblique (oblimin) rotation was used, as the questionnaire measured related latent traits (Attitudes towards animal rights and animal research). However, a relatively high correlation was observed among factors in the final factor structure (0.63), with significant cross-loadings also detected, thus these results should be interpreted with caution. A high portion of the 20 items loaded moderately (above |0.50|) on one of the two factors, which were named **Animal rights** and **Animal research**, in accordance with the questionnaire’s content and intended purpose. A total of 7 items were excluded from the EFA analysis, prompting further research on the validity of the questionnaire. 

A linear regression model was also employed to determine if the questinnaire is a reliable tool in predicting political identity. Results indicate that positive attitudes towards *Animal rights* is a significant predictor of liberal political identity, however, the total factor structure only explained around 5% of the total variance, indicating low statistical power. 

